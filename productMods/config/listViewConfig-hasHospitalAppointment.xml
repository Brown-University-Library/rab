<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- $This file is distributed under the terms of the license in /doc/license.txt$ -->

<!-- See guidelines in vitro/doc/list_view_configuration_guidelines.txt -->

<list-view-config>
    <query-select>
        PREFIX afn:   &lt;http://jena.hpl.hp.com/ARQ/function#&gt;
        PREFIX core:  &lt;http://vivoweb.org/ontology/core#&gt;
        PREFIX rdfs:  &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
        PREFIX vitro: &lt;http://vitro.mannlib.cornell.edu/ns/vitro/0.7#&gt;
        PREFIX bprofile: &lt;http://vivo.brown.edu/ontology/profile#&gt;

        SELECT DISTINCT <collated>?subclass</collated>
                        ?happt
                        ?happtText
                        ?emp ?empText
                        ?spec ?specText
                        ?start ?end ?hdept
        WHERE {
            ?subject ?property ?happt .
            ?happt rdfs:label ?happtText .
            OPTIONAL {
                    <collated>
                        ?happt vitro:mostSpecificType ?subclass
                    </collated>
                }
            OPTIONAL { ?happt bprofile:hasHospitalAppointmentEmployer ?emp .
                        ?emp rdfs:label ?empText }
            OPTIONAL { ?happt bprofile:medicalAppointmentStartDate ?start }
            OPTIONAL { ?happt bprofile:medicalAppointmentEndDate ?end }
            OPTIONAL { ?happt bprofile:hospitalAppointmentDepartment ?hdept }
        }
        ORDER BY <collated>?subclass</collated> DESC(?start)
    </query-select>

    <query-construct>
        PREFIX core: &lt;http://vivoweb.org/ontology/core#&gt;
        PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
        PREFIX vitro: &lt;http://vitro.mannlib.cornell.edu/ns/vitro/0.7#&gt;
        PREFIX bprofile: &lt;http://vivo.brown.edu/ontology/profile#&gt;

        CONSTRUCT {
            ?subject ?property ?happt .
            ?happt rdfs:label ?happtText .
            ?happt vitro:mostSpecificType ?subclass .
            ?happt bprofile:hasHospitalAppointmentEmployer ?emp .
            ?emp rdfs:label ?empText .
            ?happt bprofile:medicalAppointmentStartDate ?start .
            ?happt bprofile:medicalAppointmentEndDate ?end .
            ?happt bprofile:hospitalAppointmentDepartment ?hdept .
        } WHERE {
            {
                ?subject ?property ?happt .
                ?happt rdfs:label ?happtText .
            }
            UNION {
                ?subject ?property ?happt .
                ?happt vitro:mostSpecificType ?subclass .   
            }
            UNION {
                ?subject ?property ?happt .
                ?happt bprofile:hasHospitalAppointmentEmployer ?emp .
                ?emp rdfs:label ?empText .         
            }
            UNION {
                ?subject ?property ?happt .
                ?happt bprofile:medicalAppointmentStartDate ?startDate .
                BIND(year(?startDate) as ?start) .            
            }
            UNION {
                ?subject ?property ?happt .
                ?happt bprofile:medicalAppointmentEndDate ?endDate .
                BIND((IF
                    (year(?endDate) &lt; year(NOW()), year(?endDate), "Present")
                    )
                    as ?end) .            
            }
            UNION {
                ?subject ?property ?happt .
                ?happt bprofile:hospitalAppointmentDepartment ?hdept .           
            }
        }
    </query-construct>

    <template>propStatement-hasHospitalAppointment.ftl</template>
</list-view-config>