@prefix : <http://vitro.mannlib.cornell.edu/ns/vitro/ApplicationSetup#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

#
# configure the SearchIndexer
#

# Individuals with these types will be excluded from the search index
:searchExcluder_typeExcluder
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.exclusions.ExcludeBasedOnType> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.exclusions.SearchIndexExcluder> ;
    :excludes
        "http://www.w3.org/2002/07/owl#AnnotationProperty" ,
        "http://www.w3.org/2002/07/owl#DatatypeProperty" ,
        "http://www.w3.org/2002/07/owl#ObjectProperty" .

# Individuals with types from these namespaces will be excluded from the search index.
:searchExcluder_namespaceExcluder
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.exclusions.ExcludeBasedOnNamespace> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.exclusions.SearchIndexExcluder> ;
    :excludes
        "http://vitro.mannlib.cornell.edu/ns/vitro/0.7#" ,
        "http://vitro.mannlib.cornell.edu/ns/vitro/public#" ,
        "http://vitro.mannlib.cornell.edu/ns/bnode#" ,
        "http://www.w3.org/2002/07/owl#" .

# Individuals with URIs in these namespaces will be excluded from the search index.
:searchExcluder_typeNamespaceExcluder
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.exclusions.ExcludeBasedOnTypeNamespace> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.exclusions.SearchIndexExcluder> ;
    :excludes
        "http://vitro.mannlib.cornell.edu/ns/vitro/role#public" .

:searchExcluder_syncingTypeExcluder
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.exclusions.SyncingExcludeBasedOnType> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.exclusions.SearchIndexExcluder> .

# ------------------------------------

:uriFinder_forDataProperties
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.indexing.IndexingUriFinder> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.indexing.AdditionalURIsForDataProperties> .

:uriFinder_forObjectProperties
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.indexing.IndexingUriFinder> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.indexing.AdditionalURIsForObjectProperties> .

:uriFinder_forTypeStatements
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.indexing.IndexingUriFinder> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.indexing.AdditionalURIsForTypeStatements> .

:uriFinder_forClassGroupChange
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.indexing.IndexingUriFinder> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.indexing.URIsForClassGroupChange> .

# ------------------------------------

:documentModifier_AllNames
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "All labels are added to name fields." ;
    :hasTargetField "nameRaw" ;
    :hasSelectQuery """
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
		SELECT ?label 
		WHERE {
			?uri rdfs:label ?label .
	    }
        """ .

:documentModifier_NameFieldBooster
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.FieldBooster> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    :hasTargetField "nameRaw" ;
    :hasTargetField "nameLowercase" ;
    :hasTargetField "nameUnstemmed" ;
    :hasTargetField "nameStemmed" ;
    :hasBoost "1.2"^^xsd:float .

:documentModifier_thumbnailImageUrl
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.ThumbnailImageURL> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> .

# Single-valued attributes, stored as multivals in Solr
:documentModifier_nameT
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "All labels are added to name fields." ;
    :hasTargetField "name_t" ;
    :hasSelectQuery """
        PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#> 
        SELECT DISTINCT ?fullname
        WHERE {
            ?uri rdfs:label ?fullname .
        }
        """ .

:documentModifier_titleT
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "All labels are added to name fields." ;
    :hasTargetField "title_t" ;
    :hasSelectQuery """
        PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#> 
        PREFIX vivo:<http://vivoweb.org/ontology/core#>
        SELECT DISTINCT ?title
        WHERE {
            ?uri vivo:preferredTitle ?title .
        }
        """ .

:documentModifier_departmentT
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "All labels are added to name fields." ;
    :hasTargetField "department_t" ;
    :hasSelectQuery """
        PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#> 
        PREFIX blocal:<http://vivo.brown.edu/ontology/vivo-brown/>
        SELECT DISTINCT ?primary
        WHERE {
            ?uri blocal:primaryOrgLabel ?primary .
        }
        """ .

:documentModifier_overiewT
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "All labels are added to name fields." ;
    :hasTargetField "overview_t" ;
    :hasSelectQuery """
        PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#> 
        PREFIX vivo:<http://vivoweb.org/ontology/core#>
        SELECT DISTINCT ?overview
        WHERE {
            ?uri vivo:overview ?overview .
        }
        """ .

# Single-valued attributes

:documentModifier_emailS
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "All labels are added to name fields." ;
    :hasTargetField "email_s" ;
    :hasSelectQuery """
        PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#> 
        PREFIX vivo:<http://vivoweb.org/ontology/core#>
        SELECT DISTINCT ?email
        WHERE {
            ?uri vivo:primaryEmail ?email .
        }
        """ .

:documentModifier_shortIdS
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "All labels are added to name fields." ;
    :hasTargetField "short_id_s" ;
    :hasSelectQuery """
        PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#> 
        PREFIX blocal:<http://vivo.brown.edu/ontology/vivo-brown/>
        SELECT DISTINCT ?short
        WHERE {
            ?uri blocal:shortId ?short .
        }
        """ .

# Multivalued attributes

:documentModifier_affiliations
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "All labels are added to name fields." ;
    :hasTargetField "affiliations" ;
    :hasSelectQuery """
        PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#> 
        PREFIX blocal:<http://vivo.brown.edu/ontology/vivo-brown/>
        SELECT DISTINCT ?clnd
        WHERE {
            ?uri blocal:hasAffiliation ?aff .
            ?aff rdfs:label ?label .
            BIND(str(?label) as ?clnd) .
        }
        """ .

:documentModifier_researchAreas
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "All labels are added to name fields." ;
    :hasTargetField "research_areas" ;
    :hasSelectQuery """
        PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#> 
        PREFIX blocal:<http://vivo.brown.edu/ontology/vivo-brown/>
        PREFIX vivo:<http://vivoweb.org/ontology/core#>
        SELECT DISTINCT ?label
        WHERE {
            {
              ?uri vivo:hasResearchArea ?ra .
              ?ra rdfs:label ?label .
	    } UNION {
              ?uri blocal:hasGeographicResearchArea ?gra .
              ?gra rdfs:label ?label .
            }
        }
        """ .

:documentModifier_publishedIn
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "All labels are added to name fields." ;
    :hasTargetField "published_in" ;
    :hasSelectQuery """
        PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#> 
        PREFIX bcite:<http://vivo.brown.edu/ontology/citation#>
        SELECT DISTINCT ?label
        WHERE {
            ?uri bcite:contributorTo ?cite .
            ?cite bcite:hasVenue ?venue .
            ?venue rdfs:label ?label .
        }
        """ .

:documentModifier_alumniOf
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "All labels are added to name fields." ;
    :hasTargetField "alumni_of" ;
    :hasSelectQuery """
        PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#> 
        PREFIX vivo:<http://vivoweb.org/ontology/core#>
        SELECT DISTINCT ?label
        WHERE {
            ?uri vivo:educationalTraining ?edu .
            ?edu vivo:trainingAtOrganization ?org .
            ?org rdfs:label ?label .
        }
        """ .

# Build JSON attributes

:documentModifier_affiliationsJSON
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "All labels are added to name fields." ;
    :hasTargetField "affiliations_json" ;
    :hasSelectQuery """
        PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#> 
        PREFIX blocal:<http://vivo.brown.edu/ontology/vivo-brown/>
        SELECT DISTINCT ?json
        WHERE {
            ?uri blocal:hasAffiliation ?aff .
            ?aff rdfs:label ?label .
            BIND(replace( '\"uri\":\"aff\",', 'aff', str(?aff) ) as ?uriStr)
            BIND(replace( '\"id\":\"aff\",', 'aff', str(?aff) ) as ?idStr)
            BIND(replace( '\"name\":\"aff\"', 'aff', str(?label) ) as ?nameStr)
            BIND(concat( '{', ?uriStr, ?idStr, ?nameStr, '}') as ?json)
        }
        """ .

### Expects a title for each collaborator; OPTIONAL or UNION?
:documentModifier_collaboratorsJSON
    a   <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.SelectQueryDocumentModifier> ,
        <java:edu.cornell.mannlib.vitro.webapp.searchindex.documentBuilding.DocumentModifier> ;
    rdfs:label "All labels are added to name fields." ;
    :hasTargetField "collaborators_json" ;
    :hasSelectQuery """
        PREFIX rdfs:<http://www.w3.org/2000/01/rdf-schema#> 
        PREFIX vivo:<http://vivoweb.org/ontology/core#>
        SELECT DISTINCT ?json
        WHERE {
            ?uri vivo:hasCollaborator ?clb .
            ?clb rdfs:label ?label .
            ?clb vivo:preferredTitle ?title .
            BIND(replace( '\"uri\":\"clb\",', 'clb', str(?clb) ) as ?uriStr)
            BIND(replace( '\"id\":\"clb\",', 'clb', str(?clb) ) as ?idStr)
            BIND(replace( '\"name\":\"clb\",', 'clb', str(?label) ) as ?nameStr)
            BIND(replace( '\"title\":\"val\"', 'val', str(?title) ) as ?titleStr)
            BIND(concat( '{', ?uriStr, ?idStr, ?nameStr, ?titleStr, '}' ) as ?json)
        }
        """ .

